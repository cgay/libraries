<html>
<head>
  <title>Koala Documentation</title>

  <style><!--
  body        { font-family: Arial,Helvetica,Sans-serif; font-size: 10pt; }
  blockquote.code { font-family: monospace,courier; }
  .defname    { font-size: 14pt; font-weight: bold; }
  .defheader  { font-size: 13pt; font-weight: bold; }
  .deftype    { font-size: 12pt; font-style: italic; }
  .deflib     { font-size: 13pt; font-style: normal; }
  .param      { font-size: 10pt; font-style: italic; }
  -->
  </style>

</head>

<body text="#000000" bgcolor="#F0F0FF">

<h1 align="center">Koala Documentation</h1>

This is a preliminary release of the Koala HTTP server and Dylan Server
Pages.

<h2>Contents</h2>

<ol>
  <li><a href="#getting-started">Getting Started</a></li>
  <li><a href="#users-guide">User's Guide</a></li>
  <li><a href="dsp.html">Dylan Server Pages</a></li>
</ol>
<p>

<!-- ============================== Getting Started =============================== -->
<hr>
<a name="getting-started"></a>
<h2>Getting Started</h3>

<h3>Organization of the Koala distribution</h3>

<table border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td><code>koala/bin</code></td>
    <td>Binaries for Koala, the demo, the XML-RPC client, etc</td>
  </tr>
  <tr>
    <td><code>koala/config/</code></td>
    <td>Koala configuration files.</td>
  </tr>
  <tr>
    <td><code>koala/lib/</code></td>
    <td>Third-party libraries.</td>
  </tr>
  <tr>
    <td><code>koala/sources/koala</code></td>
    <td>Koala and Dylan Server Pages sources.</td>
  </tr>
  <tr>
    <td><code>koala/sources/examples</code></td>
    <td>Demo applications.</td>
  </tr>
  <tr>
    <td><code>koala/sources/xml-rpc-client&nbsp;&nbsp;</code></td>
    <td>An XML-RPC client</td>
  </tr>
  <tr>
    <td><code>koala/sources/xml-rpc-common&nbsp;&nbsp;</code></td>
    <td>Code shared by the XML-RPC client and server.</td>
  </tr>
  <tr>
    <td><code>koala/www</code></td>
    <td>Web pages</td>
  </tr>
  <tr>
    <td><code>koala/www/demo</code></td>
    <td>Dylan Server Pages templates for the demo application.</td>
  </tr>
  <tr>
    <td><code>koala/www/koala</code></td>
    <td>These Koala web pages.</td>
  </tr>
</table>


<h3>Running Koala</h3>

So far Koala only runs on Windows.  I hope to fix this as soon as possible.

<p>If you're using the binary version, you can start the demo application
by double clicking on koala-example.exe in the koala/bin/ directory.

<p>If you have the source version, see <a href="#building">Building Koala</a>, below.

<p>Point your browser at <a
href="http://localhost/">http://localhost/</a> to browse the documents
in koala/www, or <a
href="http://localhost/demo/home.dsp">http://localhost/demo/home.dsp</a>
for the Dylan Server Pages demo.  If you want to change the default
settings (for example the port number or document root directory) you
can edit a copy of <i>koala-dir</i>/config/koala-config.xml and put it in
sources/example/config/koala-config.xml.  The config file has many
comments explaining configuration settings.


<a name="building"></a>
<h3>Building on Windows</h3>

If you have a source distribution then you can build Koala using <a
href="http://www.functionalobjects.com">Functional Developer</a> (free
evaluation versions available).  Just open
sources/koala-app/koala-app.hdp in FunDev and choose Project / Build
from the menu.  You will probably want to edit the koala-config.xml file
to turn on debugging.  (See comments in the file for how to do that.)

<h3>Building on Linux</h3>

(Thanks to Hannes Mehnert for figuring out how to do this.)

<UL>
<li>get fundev cvs module</li>
<li>apply following patch (in Sources/lib/run-time/pentium-linux/) to mask SIGPIPE:
  <pre>
diff -u -r1.1.1.1 x86-linux-exceptions.c
--- x86-linux-exceptions.c      12 Mar 2004 00:09:07 -0000      1.1.1.1
+++ x86-linux-exceptions.c      30 Mar 2004 00:56:20 -0000
@@ -54,6 +54,8 @@
   struct sigaction newFPEHandler;
   struct sigaction newSEGVHandler;
 
+  sigset_t set, oldset;
+
   newFPEHandler.sa_handler = oldFPEHandler->sa_handler;
   sigemptyset(&newFPEHandler.sa_mask);
   newFPEHandler.sa_flags = 0;
@@ -63,6 +65,10 @@
   sigemptyset(&newSEGVHandler.sa_mask);
   newSEGVHandler.sa_flags = 0;
   sigaction(SIGSEGV, &newSEGVHandler, oldSEGVHandler);
+
+  sigemptyset(&set);
+  sigaddset(&set, SIGPIPE);
+  sigprocmask(SIG_BLOCK, &set, &oldset);
 }
 
 static void RemoveDylanExceptionHandlers (struct sigaction * oldFPEHandler,
  </pre>
</li>
<li>bootstrap fundev</li>
<li>get libraries cvs module</li>
<li>make a personal registry
  <p>There's a simple script to create the registries for you, in
     KOALA-DIR/make-registries.sh.  For example, if your koala checkout
     is in /home/me/libraries/koala and you want your registry to be in
     /home/me/dylan:
  <pre>
cd /home/me/dylan
/home/me/libraries/koala/make-registries.sh ../libraries/koala
  </pre>
</li>
<li>start Bootstrap.final/bin/minimal-console-compiler</li>
<li>set personal-root "/home/me/dylan/registry"</li>
<li>open koala-app</li>
<li>build
    <p>(you'll find the build products in /home/me/dylan/registry/Build/bin)
</li>
<li>create /home/me/dylan/registry/Build/config/ and put koala/config/mime-type-map.xml
  and koala/config/koala-config.xml in it</li>

<li>If not running koala-app as root, update koala-config.xml to use a port
    number above 1024.</li>

<li>If you're on linux-2.6 you need to set THREAD_LIBRARY_USES_SEGMENT_REGISTER to TRUE
 (export THREAD_LIBRARY_USES_SEGMENT_REGISTER=TRUE in bash,
  setenv THREAD_LIBRARY_USES_SEGMENT_REGISTER TRUE in tcsh)
and run 'strace ./dsp-basics'

<li>now run koala-app</li>

</UL>


<!-- ============================== User's Guide =============================== -->
<hr>
<a name="users-guide"></a>
<h2>User's Guide</h2>

--TO BE DOCUMENTED--

<p>To access the XML-RPC server, POST to <a href="http://localhost/RPC2">http://localhost/RPC2</a>.
(Going to that URI when Koala is running will result in a valid XML-RPC fault response, since
there's no request document to parse.)

<p>The XML-RPC client is available as the xml-rpc-client library in
<i>koala-dir</i>/sources/xml-rpc-client.  The main interfaces are the
xml-rpc-call and xml-rpc-call-2 methods.  The latter takes a port number
and URL in addition to the method name and arguments.

</body>
</html>
