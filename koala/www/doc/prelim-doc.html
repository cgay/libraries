<html>
<head>
  <title>DSP Preliminary Documentation</title>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>

<body>

<h1>DSP Preliminary Documentation</h1>

<h2>Table of Contents</h2>

<ol>
  <li>Overview</li>
  <li>Tags</li>
  <li>Tag Libraries</li>
</ol>

<pre>
Overview

Dylan Server Pages (DSP) is a template engine for providing dynamic web site content using
the Dylan language.  They are similar in spirit to JavaServer Pages, but without the
ability to mix program logic and page content, which everyone agrees is a bad idea anyway.
All dynamic content is invoked via DSP tag calls such as &lt;xx:show-current-username/&gt;.

Currently, a DSP application is implemented as a Dylan project that uses the Koala HTTP
server library.  This effectively means that each DSP application has to run on a
different Koala server and therefore on a different HTTP port.  (The plan is to eventually
fix Koala to load DSP application libraries at runtime, based on configuration files, or
better, to implement mod_dylan for Apache.)


DSP Directives

A DSP "directive" is used much like a normal DSP tag, but it couldn't be written as a
normal tag without special support from the DSP engine. DSP directives are distinguished
by the "%dsp" tag prefix.  There are three built in DSP directives:

  %dsp:include
    Includes another DSP template (or plain HTML file) in the current page.
    Example usage:
      &lt;%dsp:include url="header.dsp"/&gt;

    Note that if the url given is absolute (i.e., begins with a slash) then the document
    is looked up relative to the document root directory.  Otherwise it is looked up
    relative to the directory containing the current document.

  %dsp:taglib
    Declares another tag library to be in effect for the remainder of the page.  Taglib
    directives are cumulative.  That is, using two or more %dsp:taglib directives on
    the same page means that tags in either taglib may be used on that page.
    Example usage:
      &lt;%dsp:taglib name="my-taglib" prefix="xx"/&gt;
      ...
      &lt;xx:my-tag/&gt;
      ...

  %dsp:if
    Conditionally includes its body content if a predicate returns true.  This could be
    written trivially as a custom tag, except for the fact that it allows a %dsp:else part.
    This way the test predicate only needs to be executed once.
    Example usage:
      &lt;%dsp:if test="my-predicate?"&gt;
        ...true part...
      &lt;%dsp:else&gt;
        ...false part...
      &lt;/%dsp:if&gt;


Tag Libraries

Tags can be organized into separate tag libraries if needed (e.g., for large web apps).
Each DSP page may use the %dsp:taglib directive to specify which tag libraries are active
for that page.  The built-in "dsp" tag library is automatically available to all DSP
pages, without having to use the %dsp:taglib directive to make it active.  The "dsp"
taglib includes some tags that are useful for almost all web pages.

Taglibs are fairly uninteresting as far as programming a DSP application goes.  They
are only used when defining tags, to specify which taglib the tag belongs to.
They are defined as follows:

  define taglib example ()
  end;

The above defines a taglib named "example".  See the Tags section for how the taglib is
specified when defining a tag.  This taglib would be included in a page with the following
directive:

  &lt;%dsp:taglib name="example" prefix="ex"/&gt;


Tags

Tags are defined with the "define tag" macro.  The syntax is:

  define tag tag-name [in taglib-name] (method-parameters) (tag-parameters)
    tag-body
  end;

The following example tag should clear things up a bit:

  define tag current-time in example
      (page :: &lt;dylan-server-page&gt;, response :: &lt;response&gt;)
      (type)
    write(output-stream(response), current-time(type));
  end;

The above defines a tag called "current-time" in the "example" taglib which outputs the
current time in the DSP page.  parameters-1 specifies the parameter list for when the DSP
engine invokes the tag.  It must always accept two arguments, page and response.  The
first argument will be an instance of &lt;dylan-server-page&gt; and the second will be an
instance of &lt;response&gt;.


</pre>

<h1>DSP Technical Reference</h1>

<span class="defname">define taglib</span> <span class="deftype">Macro</span>
<p>
<h3 class="defheader">Signature</h3>
<blockquote>
  define taglib <i>taglib-name</i> ()<br>
  end
</blockquote>

<h3 class="defheader">Summary</h3>
<blockquote>
  Defines a new tag library with name <i>taglib-name</i>.
</blockquote>

<hr>

<span class="defname">define tag</span> <span class="deftype">Macro</span>
<h3 class="defheader">Signature</h3>
<blockquote>
  define [<i>modifiers</i>] tag <i>tag-name</i> [in <i>taglib-name</i>]<br>
  &nbsp;&nbsp;&nbsp;&nbsp;(<i>method-parameters</i>)<br>
  &nbsp;&nbsp;&nbsp;&nbsp;(<i>tag-call-parameters</i>)<br>
  &nbsp;&nbsp;<i>tag-body</i><br>
  end
</blockquote>

<h3 class="defheader">Summary</h3>
<blockquote>
  Defines a new tag named <i>tag-name</i> in the <i>taglib-name</i> tag library.
  If <i>taglib-name</i> isn't specified it defaults to &quot;dsp&quot;.
  <p>
  When the DSP engine invokes the tag it passes arguments that match <i>method-parameters</i>.
  
</blockquote>

<h3 class="defheader">Arguments</h3>

<table border="0" width="98%" align="center">
  <tr><td width="100%" colspan="2"><i>modifiers</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      The only valid modifier is <code>body</code>, which must be used if the tag is allowed to have a body.  If <code>body</code> is specified, <i>method-parameters</i> must have a third parameter (see below).
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>tag-name</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      The name of the tag, as it will appear in the .dsp file.
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>taglib-name</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      The name of the taglib the tag should be added to.  If not specified, the &quot;dsp&quot; tag library will be used.
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>method-parameters</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      Each tag definition creates a method that will be called when the tag is invoked.
      This is the parameter list for that method.  The basic form of the parameter list
      is (<i>page</i>, <i>response</i> [, <i>process-body</i>]).  <i>page</i>
      is an instance of <code>&lt;dylan-server-page&gt;</code>.  <i>response</i> is an
      instance of <code>&lt;response&gt;</code>.  <i>process-body</i> is an instance of
      <code>&lt;function&gt;</code>.  The <i>process-body</i> argument is optional, 

      <p>If the <code>body</code> modifier is not specified, the 
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>modifiers</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>modifiers</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
    </td>
  </tr>
</table>

</body>
</html>

